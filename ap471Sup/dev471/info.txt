


















                                    Acromag, Inc.
                                 30765 S.Wixom Road
                      
                              Wixom, Michigan 48393-7037

                                Phone: (248)295-0310
                                  FAX: (248)624-9234

                               Linux Software Library
                         Information File for AP471 Devices
                                        V1.0
                                      12/01/15




               The  information  in this manual is subject to  change
               without notice.   Acromag,  Inc.  makes no warranty of
               any kind with regard to this material and accompanying
               software,  including, but not limited to , the implied
               warranties  of  merchantability  and  fitness  for   a
               particular   purpose.    Acromag,   Inc.   assumes  no
               responsibility for any errors that may appear in  this
               manual and accompanying software.

               See GPL.txt and LGPL.txt.




























	Compiling and Loading the Device Driver Module

        i)   Copy the AP471 device driver routines from the "dev471"
             directory of the source media to a new directory  under
             /home/AP/AP471/dev471.  Device I.D. and device name are
             user selectable see AP471.h.  Select Message Signaled Interrupt
             (MSI) by locating the "#define AP_USE_MSI_INT" in dev471.c
             uncomment to enable MSI interrupt.

        ii)  Create device nodes for each ap471 board in the /dev directory using
             "mknod ap471_0 c 46 0" 	(1st board)
             "mknod ap471_1 c 46 1" 	(2nd board)
             "mknod ap471_2 c 46 2" 	(3rd board)
             "mknod ap471_3 c 46 3" 	(4th board)
             The command line items are as follows:
             ap471_x - Device name x = minor number 0 - 3. 
             c       - Character device driver.
             46      - Major number is defined in the device driver file. The major number
                       must be unique for each type of board/device driver.
                       When two or more different Acromag boards are used in the same system,
                       this number may be changed to avoid device number collisions.
             x       - Minor number 0 to 3.

             To create persistent device nodes for Acromag PCI board products.
             Edit your '/etc/rc.d/rc.local' as follows:
             #Acromag ap471
             if [ ! -r /dev/ap471_0 ]; then
             /bin/mknod -m 666 /dev/ap471_0 c 46 0 #(1st board)
             /bin/mknod -m 666 /dev/ap471_1 c 46 1 #(2nd board)
             /bin/mknod -m 666 /dev/ap471_2 c 46 2 #(3rd board)
             /bin/mknod -m 666 /dev/ap471_3 c 46 3 #(4th board)
             fi
             
             You may also need to change the permissions of this file.
             From a console use 'sudo nautilus --browser'
             
             Owner = root
             Group = root
             Execute = Allow executing as a program
             SELinux Context = initrc_exec_t

             or to change the permissions from a root console
             chown root rc.local
             chown root:root rc.local
             chmod 777 rc.local

             You may also need to enable the rc-local service.
             From a console use 'sudo systemctl enable rc-local.service'.
                          
        iii) Use the makefile to build the project, you may need to install
             elfutils-libelf-devel for your development platform in order
             to use make.

        iv)  As 'root' load the module by using the insmod utility 
             "insmod /home/AP/AP471/dev471/ap471.ko"
  
        v)   Go to the AP471 directory and see the info471.txt
             file for information about compiling demonstration programs.

